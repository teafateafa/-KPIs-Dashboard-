<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ูุธุงู ุชูุงุฑูุฑ ุฃุฏุงุก ุงููุญุชูู | ุฃูุงุฏูููุฉ ุงููุฎุจุฉ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body {
            font-family: 'Cairo', sans-serif;
            background-color: #f3f4f6;
        }
        .kpi-card {
            transition: all 0.3s ease;
        }
        .kpi-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }
        @media print {
            .no-print {
                display: none;
            }
            .print-only {
                display: block;
            }
            body {
                background-color: white;
            }
            .shadow-lg {
                box-shadow: none !important;
                border: 1px solid #ddd;
            }
        }
    </style>
</head>
<body class="text-gray-800">

    <!-- Header -->
    <header class="bg-blue-900 text-white p-4 shadow-md">
        <div class="container mx-auto flex justify-between items-center">
            <h1 class="text-2xl font-bold"><i class="fas fa-chart-line ml-2"></i>ูุธุงู ุชุชุจุน ุฃุฏุงุก ุงููุญุชูู (KPIs Dashboard)</h1>
            <span class="text-sm bg-blue-800 px-3 py-1 rounded-full">ุฃูุงุฏูููุฉ ุงููุฎุจุฉ ุงูุฏูููุฉ</span>
        </div>
    </header>

    <div class="container mx-auto p-4 flex flex-col lg:flex-row gap-6">

        <!-- Sidebar: Input Form -->
        <div class="w-full lg:w-1/4 bg-white p-6 rounded-lg shadow-lg h-fit no-print">
            <h2 class="text-xl font-bold mb-4 text-blue-900 border-b pb-2">1. ุฅุฏุฎุงู ุจูุงูุงุช ุงูุดูุฑ</h2>
            
            <form id="kpiForm" onsubmit="addMonthData(event)">
                <div class="mb-3">
                    <label class="block text-sm font-bold mb-1">ุงูุดูุฑ</label>
                    <select id="monthInput" class="w-full border p-2 rounded focus:outline-none focus:border-blue-500">
                        <option value="ููุงูุฑ">ููุงูุฑ</option>
                        <option value="ูุจุฑุงูุฑ">ูุจุฑุงูุฑ</option>
                        <option value="ูุงุฑุณ">ูุงุฑุณ</option>
                        <option value="ุฃุจุฑูู">ุฃุจุฑูู</option>
                        <option value="ูุงูู">ูุงูู</option>
                        <option value="ููููู">ููููู</option>
                        <option value="ููููู">ููููู</option>
                        <option value="ุฃุบุณุทุณ">ุฃุบุณุทุณ</option>
                        <option value="ุณุจุชูุจุฑ">ุณุจุชูุจุฑ</option>
                        <option value="ุฃูุชูุจุฑ">ุฃูุชูุจุฑ</option>
                        <option value="ููููุจุฑ">ููููุจุฑ</option>
                        <option value="ุฏูุณูุจุฑ">ุฏูุณูุจุฑ</option>
                    </select>
                </div>

                <div class="mb-3">
                    <label class="block text-sm font-bold mb-1">ุนุฏุฏ ุงูุจูุณุชุงุช (Posts)</label>
                    <input type="number" id="postsInput" class="w-full border p-2 rounded" placeholder="ูุซูุงู: 12" required>
                </div>

                <div class="mb-3">
                    <label class="block text-sm font-bold mb-1">ุฅุฌูุงูู ุงููุตูู (Reach)</label>
                    <input type="number" id="reachInput" class="w-full border p-2 rounded" placeholder="ูุซูุงู: 50000" required>
                </div>

                <div class="mb-3">
                    <label class="block text-sm font-bold mb-1">ุงูุชูุงุนู (Engagement)</label>
                    <input type="number" id="engagementInput" class="w-full border p-2 rounded" placeholder="ูุงูู + ุดูุฑ + ููููุช" required>
                </div>

                <div class="mb-3">
                    <label class="block text-sm font-bold mb-1">ุงูุฑุณุงุฆู/ุงูุนููุงุก (Leads)</label>
                    <input type="number" id="leadsInput" class="w-full border p-2 rounded" placeholder="ุงููุงุณ ุงููู ุณุฃูุช ุจูุงู" required>
                </div>

                <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded transition duration-200">
                    <i class="fas fa-plus ml-1"></i> ุฅุถุงูุฉ ููุชูุฑูุฑ
                </button>
                <button type="button" onclick="window.print()" class="w-full mt-2 bg-gray-600 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded transition duration-200">
                    <i class="fas fa-print ml-1"></i> ุทุจุงุนุฉ ุงูุชูุฑูุฑ PDF
                </button>
            </form>
        </div>

        <!-- Main Dashboard -->
        <div class="w-full lg:w-3/4">
            
            <!-- Summary Cards -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                <div class="kpi-card bg-white p-4 rounded-lg shadow border-r-4 border-blue-500">
                    <div class="text-gray-500 text-sm">ูุนุฏู ุงูุชูุงุนู (Engagement Rate)</div>
                    <div class="text-2xl font-bold text-blue-900" id="avgEngRate">0%</div>
                    <div class="text-xs text-green-600 mt-1"><i class="fas fa-check-circle"></i> ูุคุดุฑ ุฌูุฏุฉ ุงููุญุชูู</div>
                </div>
                <div class="kpi-card bg-white p-4 rounded-lg shadow border-r-4 border-green-500">
                    <div class="text-gray-500 text-sm">ูุนุฏู ุชุญููู ุงูุนููุงุก (Conversion)</div>
                    <div class="text-2xl font-bold text-green-900" id="avgConvRate">0%</div>
                    <div class="text-xs text-green-600 mt-1"><i class="fas fa-dollar-sign"></i> ูุคุดุฑ ุงููุจูุนุงุช</div>
                </div>
                <div class="kpi-card bg-white p-4 rounded-lg shadow border-r-4 border-purple-500">
                    <div class="text-gray-500 text-sm">ุฅุฌูุงูู ุงููุตูู (Total Reach)</div>
                    <div class="text-2xl font-bold text-purple-900" id="totalReachDisplay">0</div>
                    <div class="text-xs text-purple-600 mt-1"><i class="fas fa-bullhorn"></i> ูุคุดุฑ ุงูุงูุชุดุงุฑ</div>
                </div>
            </div>

            <!-- Charts Section -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                <div class="bg-white p-4 rounded-lg shadow">
                    <h3 class="font-bold text-gray-700 mb-4 border-b pb-2">ููู ุงูุนููุงุก ุงููุญุชูููู (Leads Growth)</h3>
                    <canvas id="leadsChart"></canvas>
                </div>
                <div class="bg-white p-4 rounded-lg shadow">
                    <h3 class="font-bold text-gray-700 mb-4 border-b pb-2">ููุงุฑูุฉ ุงููุตูู (Reach)</h3>
                    <canvas id="reachChart"></canvas>
                </div>
            </div>

            <!-- Data Table -->
            <div class="bg-white p-6 rounded-lg shadow mb-6 overflow-x-auto">
                <h3 class="font-bold text-gray-700 mb-4">ุณุฌู ุงูุจูุงูุงุช ุงูุดูุฑู</h3>
                <table class="w-full text-right border-collapse">
                    <thead>
                        <tr class="bg-gray-100 text-gray-600">
                            <th class="p-3 border-b">ุงูุดูุฑ</th>
                            <th class="p-3 border-b">ุงูุจูุณุชุงุช</th>
                            <th class="p-3 border-b">ุงููุตูู</th>
                            <th class="p-3 border-b">ุงูุชูุงุนู</th>
                            <th class="p-3 border-b">ุงูุนููุงุก (Leads)</th>
                            <th class="p-3 border-b">ูุณุจุฉ ุงูููู</th>
                        </tr>
                    </thead>
                    <tbody id="dataTableBody">
                        <!-- Rows will be added here JS -->
                    </tbody>
                </table>
            </div>

            <!-- Auto-Generated Email Template -->
            <div class="bg-blue-50 border border-blue-200 p-6 rounded-lg shadow no-print">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="font-bold text-blue-900"><i class="fas fa-envelope-open-text ml-2"></i>ุชูุฑูุฑ ุฌุงูุฒ ูููุฏูุฑ (ูุณุฎ ููุตู)</h3>
                    <button onclick="copyEmail()" class="text-sm bg-white border border-blue-300 px-3 py-1 rounded hover:bg-blue-100 text-blue-700">
                        <i class="fas fa-copy"></i> ูุณุฎ ุงููุต
                    </button>
                </div>
                <textarea id="emailTemplate" class="w-full h-48 p-3 text-sm border rounded bg-white text-gray-700 focus:outline-none" readonly>
ูู ุจุฅุถุงูุฉ ุจูุงูุงุช ุดูุฑ ูุงุญุฏ ุนูู ุงูุฃูู ููุชู ุชูููุฏ ุงูุชูุฑูุฑ ุชููุงุฆูุงู ููุง...
                </textarea>
            </div>
        </div>
    </div>

    <!-- JavaScript Logic -->
    <script>
        // Data Storage
        let reportData = [];
        let leadsChartInstance = null;
        let reachChartInstance = null;

        // Initialize Charts
        function initCharts() {
            const ctxLeads = document.getElementById('leadsChart').getContext('2d');
            const ctxReach = document.getElementById('reachChart').getContext('2d');

            leadsChartInstance = new Chart(ctxLeads, {
                type: 'bar',
                data: { labels: [], datasets: [{ label: 'ุงูุฑุณุงุฆู (Leads)', data: [], backgroundColor: '#10B981', borderRadius: 5 }] },
                options: { responsive: true, plugins: { legend: { display: false } } }
            });

            reachChartInstance = new Chart(ctxReach, {
                type: 'line',
                data: { labels: [], datasets: [{ label: 'ุงููุตูู (Reach)', data: [], borderColor: '#3B82F6', tension: 0.4, fill: true, backgroundColor: 'rgba(59, 130, 246, 0.1)' }] },
                options: { responsive: true, plugins: { legend: { display: false } } }
            });
        }

        // Add Data Function
        function addMonthData(e) {
            e.preventDefault();
            
            // Get values
            const month = document.getElementById('monthInput').value;
            const posts = parseInt(document.getElementById('postsInput').value);
            const reach = parseInt(document.getElementById('reachInput').value);
            const engagement = parseInt(document.getElementById('engagementInput').value);
            const leads = parseInt(document.getElementById('leadsInput').value);

            // Calculations
            let growth = 0;
            let leadsGrowth = 0; // New: Calculate Leads Growth separately

            if (reportData.length > 0) {
                const lastData = reportData[reportData.length - 1];
                
                // Reach Growth
                if (lastData.reach > 0) {
                    growth = ((reach - lastData.reach) / lastData.reach) * 100;
                }
                
                // Leads Growth
                if (lastData.leads > 0) {
                    leadsGrowth = ((leads - lastData.leads) / lastData.leads) * 100;
                }
            }

            const engRate = ((engagement / reach) * 100).toFixed(2);
            const convRate = ((leads / reach) * 100).toFixed(2);

            // Add to array
            const newData = { 
                month, 
                posts, 
                reach, 
                engagement, 
                leads, 
                growth: growth.toFixed(1),
                leadsGrowth: leadsGrowth.toFixed(1), // Store leads growth
                engRate, 
                convRate 
            };
            reportData.push(newData);

            // Update UI
            updateTable();
            updateChartsData();
            updateSummaryCards();
            generateEmailTemplate(newData);

            // Reset form partly
            document.getElementById('postsInput').value = '';
            document.getElementById('reachInput').value = '';
            document.getElementById('engagementInput').value = '';
            document.getElementById('leadsInput').value = '';
        }

        // Update Table
        function updateTable() {
            const tbody = document.getElementById('dataTableBody');
            tbody.innerHTML = '';
            reportData.forEach(row => {
                const growthClass = row.growth > 0 ? 'text-green-600' : (row.growth < 0 ? 'text-red-600' : 'text-gray-600');
                const growthIcon = row.growth > 0 ? 'โ' : (row.growth < 0 ? 'โ' : '-');
                
                const tr = `
                    <tr class="border-b hover:bg-gray-50">
                        <td class="p-3 font-bold">${row.month}</td>
                        <td class="p-3">${row.posts}</td>
                        <td class="p-3">${row.reach.toLocaleString()}</td>
                        <td class="p-3">${row.engagement.toLocaleString()} <span class="text-xs text-gray-500">(${row.engRate}%)</span></td>
                        <td class="p-3 font-bold text-blue-800">${row.leads}</td>
                        <td class="p-3 ${growthClass} font-bold" dir="ltr">${row.growth}% ${growthIcon}</td>
                    </tr>
                `;
                tbody.innerHTML += tr;
            });
        }

        // Update Charts
        function updateChartsData() {
            const labels = reportData.map(d => d.month);
            const leads = reportData.map(d => d.leads);
            const reach = reportData.map(d => d.reach);

            leadsChartInstance.data.labels = labels;
            leadsChartInstance.data.datasets[0].data = leads;
            leadsChartInstance.update();

            reachChartInstance.data.labels = labels;
            reachChartInstance.data.datasets[0].data = reach;
            reachChartInstance.update();
        }

        // Update Summary Cards
        function updateSummaryCards() {
            if (reportData.length === 0) return;
            
            // Calculate averages/totals based on all data
            let totalReach = 0;
            let totalEngRate = 0;
            let totalConvRate = 0;

            reportData.forEach(d => {
                totalReach += d.reach;
                totalEngRate += parseFloat(d.engRate);
                totalConvRate += parseFloat(d.convRate);
            });

            document.getElementById('totalReachDisplay').innerText = totalReach.toLocaleString();
            document.getElementById('avgEngRate').innerText = (totalEngRate / reportData.length).toFixed(2) + '%';
            document.getElementById('avgConvRate').innerText = (totalConvRate / reportData.length).toFixed(2) + '%';
        }

        // Generate Smart Email Template
        function generateEmailTemplate(data) {
            // Logic for Reach Text
            let reachText = "";
            if (data.growth > 0) {
                reachText = `๐ ููุง ููุซู ุฒูุงุฏุฉ ุจูุณุจุฉ ${data.growth}% ููุงุฑูุฉ ุจุงูุดูุฑ ุงูุณุงุจู.`;
            } else if (data.growth < 0) {
                reachText = `๐ ููุง ููุซู ุชุฑุงุฌุนุงู ุทูููุงู ุจูุณุจุฉ ${Math.abs(data.growth)}% ููุงุฑูุฉ ุจุงูุดูุฑ ุงูุณุงุจู.`;
            } else {
                reachText = `ูุน ุงูุญูุงุธ ุนูู ุซุจุงุช ูุนุฏูุงุช ุงููุตูู ููุงุฑูุฉ ุจุงูุดูุฑ ุงูุณุงุจู.`;
            }

            // Logic for Leads Text
            let leadsText = "";
            if (data.leadsGrowth > 0) {
                leadsText = `(ุจุฒูุงุฏุฉ ${data.leadsGrowth}% ุนู ุงูุดูุฑ ุงููุงุถู)`;
            } else if (data.leadsGrowth < 0) {
                leadsText = `(ุจุชุฑุงุฌุน ${Math.abs(data.leadsGrowth)}% ุนู ุงูุดูุฑ ุงููุงุถู)`;
            }

            const emailText = `ุงูุนููุงู: ุชูุฑูุฑ ุฃุฏุงุก ุงููุญุชูู ุงูุฑููู - ุดูุฑ ${data.month}

ุงูุณูุฏ/ ูุญูุฏ ุดุชุงุชุ
ุชุญูุงุชูุ

ุฅููู ููุฎุต ุฃุฏุงุก ุงููุญุชูู ููุฐุง ุงูุดูุฑุ ูุชุฃุซูุฑู ุงููุจุงุดุฑ ุนูู ุฃูุฏุงู ุงูุฃูุงุฏูููุฉ:

1. ุงูุฃุฑูุงู ุงูุฑุฆูุณูุฉ (Key Highlights):
- ูููุง ุจูุดุฑ ${data.posts} ูุทุนุฉ ูุญุชูู (ุชุนูููู/ุชุฑููุฌู).
- ุญูููุง ูุตููุงู (Reach) ูู ${data.reach.toLocaleString()} ุนููู ูุญุชููุ ${reachText}
- ูุฌุญูุง ูู ุฌุฐุจ ${data.leads} ุงุณุชูุณุงุฑ ูุจุงุดุฑ (Leads) ุนู ุงูููุฑุณุงุช ${leadsText}ุ ุจูุนุฏู ุชุญููู ${data.convRate}%.

2. ุงูุฌูุฏุฉ ูุงูุชูุงุนู:
- ุจูุบ ูุนุฏู ุงูุชูุงุนู ${data.engRate}%ุ ููุง ูุนูุณ ูุฏู ุงูุชูุงู ุงูุฌูููุฑ ุจุงููุญุชูู ุงูููุฏู.

3. ุงูุชูุตูุงุช ููุดูุฑ ุงููุงุฏู:
ุจูุงุกู ุนูู ูุฐู ุงูุฃุฑูุงูุ ุณูููู ุจุงูุชุฑููุฒ ุนูู ุชุญุณูู ุงููุญุชูู ูุฒูุงุฏุฉ ุนุฏุฏ ุงูุฑุณุงุฆู (Leads) ุจุดูู ุฃูุจุฑ.

ูุฑููุุ
ุชูุฑูุฑ ุงูุจูุงูุงุช ุงูุชูุตููู.`;

            document.getElementById('emailTemplate').value = emailText;
        }

        // Copy Function
        function copyEmail() {
            const copyText = document.getElementById("emailTemplate");
            copyText.select();
            document.execCommand("copy");
            alert("ุชู ูุณุฎ ุงููุต! ููููู ูุตูู ุงูุขู ูู ุงูุฅูููู.");
        }

        // Start
        window.onload = initCharts;

    </script>
</body>
</html>

